<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Chat Complete API | Elastic Security Solution [master] | Elastic</title>
<meta class="elastic" name="content" content="Chat Complete API | Elastic Security Solution [master]">

<link rel="home" href="index.html" title="Elastic Security Solution [master]"/>
<link rel="up" href="assistant-api-overview.html" title="Elastic AI Assistant API"/>
<link rel="prev" href="assistant-api-overview.html" title="Elastic AI Assistant API"/>
<link rel="next" href="conversation-api-create.html" title="Create Conversation"/>
<meta class="elastic" name="product_version" content="master"/>
<meta class="elastic" name="product_name" content="Security"/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/Security/Guide/master"/>
<meta name="DC.subject" content="Security"/>
<meta name="DC.identifier" content="master"/>
<meta name="robots" content="noindex,nofollow"/>
</head>
<body>
<div class="page_header">
This documentation contains work-in-progress information for future Elastic Stack and Cloud releases. Use the version selector to view supported release docs. It also contains some Elastic Cloud serverless information. Check out our <a href="https://www.elastic.co/docs/current/serverless">serverless docs</a> for more details.
</div>
<div class="navheader">
<span class="prev">
<a href="assistant-api-overview.html">« Elastic AI Assistant API</a>
</span>
<span class="next">
<a href="conversation-api-create.html">Create Conversation »</a>
</span>
</div>
<div class="book" lang="en">
<div class="titlepage">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elastic Security Solution [master]</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="security-apis.html">Elastic Security APIs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="assistant-api-overview.html">Elastic AI Assistant API</a></span>
</div>
<div>
<div><h1 class="title"><a id="id-1"></a>Chat Complete API</h1><a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/AI-for-security/api/chat-complete-api.asciidoc">edit</a></div>
</div>
<!--EXTRA-->
</div>
<div id="content">
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title"><a id="chat-complete-api"></a>Chat Complete API<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/AI-for-security/api/chat-complete-api.asciidoc">edit</a></h2>
</div></div></div>
<p>The Chat Complete API lets you create new Elastic AI Assistant conversations, and add messages to existing conversations.</p>
<h3><a id="_request_url_74"></a>Request URL<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/AI-for-security/api/chat-complete-api.asciidoc">edit</a></h3>
<p><code class="literal">POST &lt;kibana host&gt;:&lt;port&gt;/api/security_ai_assistant/chat/complete</code></p>
<h3><a id="_request_body_50"></a>Request body<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/AI-for-security/api/chat-complete-api.asciidoc">edit</a></h3>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
<th align="left" valign="top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">conversationId</code></p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Conversation id to which append the messages and use as a context. See conversations APIs.</p></td>
<td align="left" valign="top"><p>No</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">connectorId</code></p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Unique identifier for a connector saved object. Connector is a Kibana integration with the specific LLM provider.</p></td>
<td align="left" valign="top"><p>Yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">promptId</code></p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Default conversation prompt Id.</p></td>
<td align="left" valign="top"><p>No</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">persist</code></p></td>
<td align="left" valign="top"><p>Boolean</p></td>
<td align="left" valign="top"><p>Define if the new conversation should be created or updated if <code class="literal">conversationId</code> is provided.</p></td>
<td align="left" valign="top"><p>Yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">isStream</code></p></td>
<td align="left" valign="top"><p>Boolean</p></td>
<td align="left" valign="top"><p>Define the type of the response. If isStream equals <code class="literal">true</code>, the result will be returned as a streaming chunks.</p></td>
<td align="left" valign="top"><p>No</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">messages</code></p></td>
<td align="left" valign="top"><p><a class="xref" href="chat-complete-api.html#message-obj" title="Message object">message object</a></p></td>
<td align="left" valign="top"><p>Array of conversation messages.</p></td>
<td align="left" valign="top"><p>Yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">model</code></p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>LLM provider specific model to use.</p></td>
<td align="left" valign="top"><p>No</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">responseLanguage</code></p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Defines the language for LLM to response with.</p></td>
<td align="left" valign="top"><p>No</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="message-obj"></a>Message object<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/AI-for-security/api/chat-complete-api.asciidoc">edit</a></h3>
<div class="informaltable">
<table border="1" cellpadding="4px" width="100%">
<colgroup>
<col class="col_1"/>
<col class="col_2"/>
<col class="col_3"/>
<col class="col_4"/>
</colgroup>
<thead>
<tr>
<th align="left" valign="top">Name</th>
<th align="left" valign="top">Type</th>
<th align="left" valign="top">Description</th>
<th align="left" valign="top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">role</code></p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Message role. Could be "user", "assisatnt" or "system".</p></td>
<td align="left" valign="top"><p>Yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">content</code></p></td>
<td align="left" valign="top"><p>String</p></td>
<td align="left" valign="top"><p>Message content to send to LLM.</p></td>
<td align="left" valign="top"><p>Yes</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">data</code></p></td>
<td align="left" valign="top"><p>Object</p></td>
<td align="left" valign="top"><p>JSON object to extend the context with the specific field of the document.</p></td>
<td align="left" valign="top"><p>No</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">fields_to_anonymize</code></p></td>
<td align="left" valign="top"><p>Array</p></td>
<td align="left" valign="top"><p>List of the fields in <code class="literal">data</code> object, which should be anonymized.</p></td>
<td align="left" valign="top"><p>No</p></td>
</tr>
</tbody>
</table>
</div>
<h3><a id="_example_requests_35"></a>Example requests<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/AI-for-security/api/chat-complete-api.asciidoc">edit</a></h3>
<p><span class="strong strong"><strong>Example 1</strong></span></p>
<p>Creates a new Conversation.</p>
<div class="pre_wrapper lang-console">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-console">POST api/security_ai_assistant/current_user/conversations
{
  "connectorId": "my-gpt4o-ai",
  "conversationId": "df071e68-3c8e-4c0d-b0e7-1557e80c0319",
  "persist": true,
  "messages": [
    {
      "role": "user",
      "content": "Evaluate the event from the context and format your output neatly in markdown syntax for my Elastic Security case.\nAdd your description, recommended actions and bulleted triage steps. Use the MITRE ATT&amp;CK data provided to add more context and recommendations from MITRE, and hyperlink to the relevant pages on MITRE's website. Be sure to include the user and host risk score data from the context. Your response should include steps that point to Elastic Security specific features, including endpoint response actions, the Elastic Agent OSQuery manager integration (with example osquery queries), timelines and entity analytics and link to all the relevant Elastic Security documentation.",
      "data": {
        "event.category": "process",
        "process.pid": 69516,
        "host.os.version": 14.5,
        "host.os.name": "macOS",
        "host.name": "test-MBP",
        "process.name": "biomesyncd",
        "user.name": "usertest",
        "process.working_directory": "/",
        "event.module": "system",
        "process.executable": "/usr/libexec/biomesyncd",
        "process.args": "/usr/libexec/biomesyncd",
        "message": "Process biomesyncd (PID: 69516) by user usertest STOPPED"
      },
      "fields_to_anonymize": [
        "host.os.name",
        "event.module"
      ]
    }
  ]
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/143.console"></div>
<h3><a id="_response_code_97"></a>Response code<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/AI-for-security/api/chat-complete-api.asciidoc">edit</a></h3>
<p><code class="literal">200</code>
    Indicates a successful call.</p>
<h3><a id="_response_payload_73"></a>Response payload<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/security-docs/edit/main/docs/AI-for-security/api/chat-complete-api.asciidoc">edit</a></h3>
<p>A JSON object with an LLM response and conversation <code class="literal">id</code> if <code class="literal">persist</code> was set to true.</p>
<p><span class="strong strong"><strong>Example 1</strong></span></p>
<p>Conversation response payload:</p>
<div class="pre_wrapper lang-json">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-json">{
  "connector_id": "my-gpt4o-ai",
  "data": "### Elastic Security Case: Process Stopped Event\n\n#### Description\nA process named `biomesyncd` with PID `69516` was stopped by the user `2fede99b-5ec7-4274-b990-469b4110f7ba` on the host `e4d4dc93-754e-4282-ac84-94fe72071ab1` running `dc00f5d9-bdf3-4517-b7ef-de5a89f0d071` version `14.5`. The executable path for the process is `/usr/libexec/biomesyncd`.\n\n#### Recommended Actions\n1. **Investigate the process**: Determine if the process `biomesyncd` is legitimate or potentially malicious.\n2. **Check user activity**: Review the actions performed by the user `2fede99b-5ec7-4274-b990-469b4110f7ba` around the time the process was stopped.\n3. **Analyze host behavior**: Examine the host `e4d4dc93-754e-4282-ac84-94fe72071ab1` for any other suspicious activities or anomalies.\n\n#### Triage Steps\n- **Review Process Details**:\n  - Verify the legitimacy of the process `biomesyncd`.\n  - Check the process arguments and executable path.\n- **User Activity Analysis**:\n  - Investigate the user `2fede99b-5ec7-4274-b990-469b4110f7ba` for any unusual behavior.\n- **Host Analysis**:\n  - Check for other suspicious processes or activities on the host `e4d4dc93-754e-4282-ac84-94fe72071ab1`.\n\n#### MITRE ATT&amp;CK Context\n- **Technique**: [T1059.001 - Command and Scripting Interpreter: PowerShell](https://attack.mitre.org/techniques/T1059/001/)\n- **Tactic**: Execution\n\n#### Elastic Security Features\n- **Endpoint Response Actions**: Use Elastic Security's endpoint response actions to isolate the host or terminate suspicious processes.\n- **Elastic Agent OSQuery Manager Integration**: Utilize OSQuery to gather more information about the host and processes.\n  - Example OSQuery Query:\n    ```sql\n    SELECT * FROM processes WHERE name = 'biomesyncd';\n    ```\n- **Timelines**: Create a timeline to visualize the sequence of events and correlate with other activities.\n- **Entity Analytics**: Use entity analytics to assess the risk score of the user and host.\n\n#### Elastic Security Documentation\n- \[Endpoint Security\]\(https:\//www.elastic.co/guide/en/security/current/endpoint-security.html\)\n- \[OSQuery Manager\]\(https:\//www.elastic.co/guide/en/security/current/osquery-manager.html\)\n- \[Timelines\]\(https:\//www.elastic.co/guide/en/security/current/timelines.html\)\n- \[Entity Analytics\]\(https:\//www.elastic.co/guide/en/security/current/entity-analytics.html\)\n\n### ESQL Query\n```sql\nFROM process\nWHERE process.name == \"biomesyncd\"\n  AND process.pid == 69516\n  AND user.name == \"2fede99b-5ec7-4274-b990-469b4110f7ba\"\n  AND host.name == \"e4d4dc93-754e-4282-ac84-94fe72071ab1\"\n  AND host.os.version == \"14.5\"\n```\n\nThis query can be used in an Elastic Security timeline or detection rule to detect the stopping of the `biomesyncd` process by the specified user on the specified host.",
  "trace_data": {
    "transactionId": "293ad93379ace883",
    "traceId": "eeedce3430c9ded8fb8dc38dcfd96eb4"
  },
  "replacements": {
    "dc00f5d9-bdf3-4517-b7ef-de5a89f0d071": "macOS",
    "e4d4dc93-754e-4282-ac84-94fe72071ab1": "test-MBP",
    "2fede99b-5ec7-4274-b990-469b4110f7ba": "usertest",
    "661a7e8f-42c3-4f8c-a1bc-6ff1aa750034": "system"
  },
  "status": "ok",
  "conversationId": "df071e68-3c8e-4c0d-b0e7-1557e80c0319"
}</pre>
</div>
</div>
</div>
</div><div class="navfooter">
<span class="prev">
<a href="assistant-api-overview.html">« Elastic AI Assistant API</a>
</span>
<span class="next">
<a href="conversation-api-create.html">Create Conversation »</a>
</span>
</div>
</body>
</html>
